# 一、Constitution（项目宪法/总纲）

------

## 1. 项目概述

本项目名为 **"邮轮舱位预订平台"（CruiseBooking）**，是一个面向邮轮舱位销售的全流程电商系统。系统分为 **第二类（MVP 最小可行产品）** 与 **第三类（一站式完整体验）** 两个阶段交付，涵盖从邮轮介绍展示、舱位浏览、在线预订、在线支付、订单管理到售后全链路功能。系统包含三个前端（微信小程序前台、Web 网页前台、Web 管理后台）以及统一的后端服务。

## 2. 技术栈总纲（所有版本均为截至 2026-02-10 的最新版）

### 2.1 后端（Go 技术栈）

| 层级          | 技术选型                                 | 版本                  | 说明                                   |
| :------------ | :--------------------------------------- | :-------------------- | :------------------------------------- |
| **语言**      | Go                                       | 1.26（2026年2月发布） | 后端主体语言                           |
| **Web 框架**  | Gin                                      | v1.11.0               | 高性能 HTTP 框架，路由+中间件          |
| **ORM**       | GORM                                     | v2.x（最新）          | 数据库 ORM，支持自动迁移、钩子、预加载 |
| **数据库**    | PostgreSQL                               | 17.x                  | 主数据库，存储业务数据                 |
| **缓存**      | Redis                                    | 7.4.x                 | 会话、缓存、舱位库存锁定、排行榜       |
| **搜索引擎**  | Meilisearch                              | 1.12.x                | 舱位/航线全文检索（轻量替代 ES）       |
| **消息队列**  | NATS JetStream                           | 2.11.x                | 订单异步处理、事件驱动、通知推送       |
| **对象存储**  | MinIO                                    | 最新稳定版            | 图片/视频/VR 素材存储（兼容 S3 协议）  |
| **API 规范**  | RESTful + Swagger/OpenAPI 3.1            | —                     | 全部接口必须有 Swagger 文档            |
| **WebSocket** | gorilla/websocket 或 nhooyr/websocket    | 最新                  | 实时舱位状态推送                       |
| **认证/鉴权** | JWT + Casbin                             | —                     | 基于角色的权限控制（RBAC）             |
| **配置管理**  | Viper                                    | v1.19.x               | 多环境配置、热更新                     |
| **日志**      | Zap + Lumberjack                         | 最新                  | 结构化日志、日志切割                   |
| **支付集成**  | 微信支付 V3 SDK / 支付宝 SDK             | 最新                  | 在线支付                               |
| **容器化**    | Kubernetes                               | 最新                  | 开发/部署容器化                        |
| **CI/CD**     | GitHub Actions                           | —                     | 自动构建、测试、部署                   |
| **测试**      | Go testing + testify + gomock + httptest | —                     | **100% 测试覆盖率**（单元+集成+E2E）   |

### 2.2 前端 — 管理后台（网页版）

| 层级             | 技术选型                             | 版本                       | 说明                               |
| :--------------- | :----------------------------------- | :------------------------- | :--------------------------------- |
| **框架**         | Nuxt 4                               | 4.3.0（2026年1月21日发布） | Vue 全栈框架，SSR/SSG 支持         |
| **UI 核心**      | Vue                                  | 3.5.28                     | Composition API + `<script setup>` |
| **构建工具**     | Vite                                 | 7.3.1（稳定版）            | 极速 HMR、优化构建                 |
| **UI 组件库**    | Nuxt UI v3                           | 最新                       | 基于 Tailwind CSS 的后台组件库     |
| **CSS 框架**     | Tailwind CSS                         | v4.x                       | 原子化 CSS                         |
| **状态管理**     | Pinia                                | v3.x                       | Vue 官方状态管理                   |
| **HTTP 请求**    | ofetch / useFetch (Nuxt 内置)        | —                          | 与 Nuxt 深度集成                   |
| **图表**         | ECharts                              | v5.6.x                     | 数据看板可视化                     |
| **富文本编辑器** | TipTap                               | v2.x                       | 邮轮介绍、舱房介绍等内容编辑       |
| **表单**         | VeeValidate + Zod                    | 最新                       | 表单验证                           |
| **TypeScript**   | TypeScript                           | 5.9.x                      | 全量使用 TS 严格模式               |
| **测试**         | Vitest + Vue Test Utils + Playwright | 最新                       | **100% 测试覆盖率**                |

### 2.3 前端 — 用户前台（网页版）

| 层级           | 技术选型                             | 版本   | 说明                   |
| :------------- | :----------------------------------- | :----- | :--------------------- |
| **框架**       | Nuxt 4                               | 4.3.0  | SSR 首屏直出，SEO 友好 |
| **UI 核心**    | Vue                                  | 3.5.28 | 同上                   |
| **构建工具**   | Vite                                 | 7.3.1  | 同上                   |
| **UI 组件库**  | Nuxt UI v3 + 自定义主题              | 最新   | 面向 C 端的精美 UI     |
| **CSS 框架**   | Tailwind CSS                         | v4.x   | 响应式设计、移动端适配 |
| **状态管理**   | Pinia                                | v3.x   | 同上                   |
| **动画**       | @vueuse/motion + CSS Transitions     | —      | 页面过渡与交互动效     |
| **地图**       | 高德地图 SDK / Mapbox GL             | 最新   | 港口位置展示、航线地图 |
| **TypeScript** | TypeScript                           | 5.9.x  | 同上                   |
| **测试**       | Vitest + Vue Test Utils + Playwright | 最新   | **100% 测试覆盖率**    |

### 2.4 前端 — 小程序前台

| 层级           | 技术选型                                      | 版本                   | 说明                     |
| :------------- | :-------------------------------------------- | :--------------------- | :----------------------- |
| **框架**       | uni-app（Vue 3 模式）                         | HBuilderX 最新稳定版   | 一套代码编译到微信小程序 |
| **UI 核心**    | Vue                                           | 3.5.28（uni-app 内置） | Composition API          |
| **UI 组件库**  | uni-ui + 自定义组件                           | 最新                   | 小程序原生组件适配       |
| **CSS 方案**   | rpx + scss                                    | —                      | 小程序响应式单位         |
| **状态管理**   | Pinia（uni-app 集成）                         | v3.x                   | 同上                     |
| **HTTP**       | uni.request 封装 / luch-request               | 最新                   | 统一请求拦截             |
| **地图**       | 微信小程序地图组件                            | —                      | 港口展示                 |
| **支付**       | wx.requestPayment                             | —                      | 微信支付                 |
| **TypeScript** | TypeScript                                    | 5.9.x                  | 全量 TS                  |
| **测试**       | jest + @vue/test-utils + miniprogram-simulate | 最新                   | **100% 测试覆盖率**      |

### 2.5 基础设施与通用

| 类别         | 技术                              | 说明                    |
| :----------- | :-------------------------------- | :---------------------- |
| **代码仓库** | git                               | 后端 + 三个前端统一管理 |
| **API 文档** | Swagger UI / Redoc (OpenAPI 3.1)  | 自动生成                |
| **代码规范** | golangci-lint / ESLint + Prettier | 强制 CI 检查            |
| **监控**     | Prometheus + Grafana              | 服务监控                |
| **日志收集** | Loki                              | 集中式日志              |
| **反向代理** | Caddy v2                          | 自动 HTTPS、反向代理    |

## 3. 测试策略总纲

**所有代码（后端、三个前端）的测试覆盖率必须达到 100%。** 具体策略：

- **后端（Go）**：每个 handler、service、repository、middleware 均必须有单元测试（testify + gomock）；关键业务流程（下单、支付、退改）必须有集成测试（httptest + 真实数据库容器 testcontainers-go）；API 端到端测试覆盖全部接口。
- **管理后台 & 网页前台（Nuxt 4）**：所有组件使用 Vitest + Vue Test Utils 编写单元测试；所有页面使用 Playwright 编写端到端测试；Nuxt 服务端路由使用 Vitest 编写集成测试。
- **小程序前台（uni-app）**：所有组件使用 jest + @vue/test-utils 编写单元测试；使用 miniprogram-simulate 做小程序组件行为测试；关键流程使用微信开发者工具自动化测试。
- **CI 卡控**：GitHub Actions 中配置覆盖率阈值为 100%，低于此值 PR 无法合并。

------

# 二、Specify（详细功能规格说明）

------

## 第二类：邮轮舱位销售系统 MVP 功能列表

> 最小可行产品聚焦核心预订流程，确保用户能完成基本的舱位浏览、选择、下单、支付。

### A. 邮轮介绍模块（新增 — 后台可编辑）

本模块不在原始报告中，为本次新增需求。所有内容均可在管理后台通过富文本编辑器（TipTap）进行增删改查。

#### A.1 邮轮基本信息管理

**后台功能：**

- **邮轮列表**：展示所有已录入邮轮，支持按名称、吨位、状态（上架/下架）筛选和排序；支持分页；支持批量上/下架操作。
- **新建/编辑邮轮**：表单字段包括——
  - 邮轮名称（中英文）
  - 邮轮英文简称/代码（唯一标识）
  - 所属邮轮公司（下拉选择，公司信息可独立管理）
  - 总吨位（Gross Tonnage，数字字段，单位：吨）
  - 最大容纳人数（乘客容量，数字字段）
  - 船员人数（数字字段）
  - 建造年份 / 最近翻新年份
  - 总长度（米）、总宽度（米）、甲板层数
  - 邮轮封面图（主图，支持上传多张，拖拽排序）
  - 邮轮状态：上架 / 下架 / 维护中
  - 排序权重（数字，数值越大越靠前）
- **删除邮轮**：软删除，已关联航线/舱位的邮轮不允许删除，给出提示。

#### A.2 舱房种类管理

**后台功能：**

- **舱房类型列表**：按邮轮筛选，展示该邮轮下所有舱房类型。
- **新建/编辑舱房类型**：表单字段包括——
  - 所属邮轮（下拉选择）
  - 舱房类型名称（如"内舱房"、"海景房"、"阳台房"、"迷你套房"、"豪华套房"、"皇家套房"等，类型可手动增删改查。）
  - 舱房类型代码（如 INSIDE、OCEANVIEW、BALCONY、MINI_SUITE、SUITE、ROYAL_SUITE）
  - 面积范围（最小面积 ~ 最大面积，单位：平方米）
  - 可住人数（标准入住人数、最大入住人数）
  - 床型说明（如"双人床/可拆分为两张单人床"、"大床+沙发床"等，支持多种床型配置）
  - 舱房特色标签（多选标签，如"落地窗"、"私人阳台"、"按摩浴缸"、"管家服务"、"优先登船"等）
  - 舱房详细介绍（富文本编辑器，支持图片、视频嵌入，可描述房间布局、设施配置、视野等）
  - 舱房图片画廊（支持上传多张图片，拖拽排序，支持设置主图）
  - 舱房平面图/布局图（单独图片上传字段）
  - 含有设施清单（checkbox 多选，如：独立卫浴、吹风机、保险箱、迷你吧、电视、电话、空调、梳妆台、衣柜等）
  - 排序权重
  - 状态：启用 / 停用

#### A.3 邮轮设施介绍管理

**后台功能：**

- **设施分类管理**：可自定义设施分类（如"餐饮美食"、"休闲娱乐"、"运动健身"、"水疗养生"、"儿童乐园"、"购物中心"、"剧院演艺"、"泳池水上"、"商务会议"等），每个分类有名称、图标、排序。
- **设施列表**：按邮轮 + 设施分类筛选。
- **新建/编辑设施**：表单字段包括——
  - 所属邮轮
  - 所属分类
  - 设施名称（如"星空自助餐厅"、"海上剧院"、"无边际泳池"等）
  - 设施位置（所在甲板层）
  - 开放时间说明
  - 是否需要额外收费（是/否，若是则标注参考价格）
  - 设施详细介绍（富文本编辑器，支持图片、视频）
  - 设施图片（多张上传）
  - 适合人群标签（家庭、情侣、儿童、老年人等）
  - 排序权重
  - 状态：显示 / 隐藏

#### A.4 前台展示（小程序 + 网页）

- **邮轮列表页**：卡片式展示，每张卡片显示封面图、邮轮名称、吨位、容纳人数、舱房类型数量，点击进入详情。
- **邮轮详情页**：
  - 顶部轮播图画廊
  - 基本参数区块：吨位、容纳人数、船员数、长度、宽度、甲板数、建造/翻新年份
  - 舱房类型列表（折叠展开式）：每种类型显示主图、名称、面积、人数、起始价格，点击展开查看详细介绍和完整图册
  - 设施导览（按分类 Tab 切换）：每个设施卡片显示图片、名称、位置、是否免费
  - 设施详情弹窗/页面：完整的富文本介绍内容
  - 关联航线入口：显示该邮轮即将出发的航线列表，可直接进入预订流程

### B. 舱位商品管理（后台）

| 功能         | 详细说明                                                     |
| :----------- | :----------------------------------------------------------- |
| **舱位列表** | 展示所有可售舱位，支持按邮轮/航线/舱型（内舱/海景/阳台/套房）筛选和排序；支持分页、搜索、批量操作（上架/下架/删除）。列表字段：舱位编号、所属邮轮、所属航线、舱房类型、面积、价格区间、库存、状态。 |
| **舱位分类** | 按邮轮 → 航线 → 舱型三级分类管理；分类支持增删改查、排序、关联图标。 |
| **舱位属性** | 配置舱位 SKU 属性：舱位等级、床型（大床/双床/上下铺）、面积（平方米）、甲板层数、位置（前/中/后）、朝向（左舷/右舷）、是否有窗/阳台、附属设施（卫浴/迷你吧等 checkbox）。属性模板可复用。 |
| **舱位库存** | 各航次各舱型实时库存管理：总库存、已售数量、锁定数量（未支付订单）、可用库存自动计算；支持库存预警阈值设置（当可用库存低于 N 时触发预警通知）；库存变动日志全记录。 |
| **舱位定价** | 按日期/人数/舱型多维度价格矩阵设置：基础价格、儿童价格、单人补差价、节假日加价、早鸟优惠价、连住折扣；支持按日期区间批量设置价格；价格日历可视化展示。 |

### C. 预订流程（前台 — 小程序 + 网页）

| 功能             | 详细说明                                                     |
| :--------------- | :----------------------------------------------------------- |
| **舱位浏览**     | 用户端按航线/日期/出发港口筛选可用舱位；列表视图和地图视图（甲板图）两种浏览模式；每个舱位卡片展示：主图、舱型、面积、价格、剩余库存量级（充足/紧张/即将售罄）；支持按价格、面积、评分排序。 |
| **舱位详情页**   | 舱位图片轮播（来自关联的舱房类型图库）；舱位参数（面积、层数、位置、床型、设施）；价格日历（可选日期查看价格）；所属邮轮快速跳转链接；甲板位置示意图（标注当前舱位位置）；「立即预订」按钮。 |
| **在线下单**     | 选择航次日期 → 选择舱型 → 选择具体舱位（或系统自动分配） → 填写乘客人数 → 填写乘客基本信息（姓名、证件类型/号码、联系电话） → 确认订单金额明细 → 提交订单。订单提交后舱位进入「锁定」状态（15分钟未支付自动释放）。 |
| **乘客信息管理** | 填写每位乘客：姓名（中/英文）、证件类型（身份证/护照/其他）、证件号码、手机号、邮箱、紧急联系人及电话、特殊需求备注（饮食要求、无障碍需求等）。支持保存常用乘客信息，下次自动填充。 |

### D. 订单与支付（后台 + 前台）

| 功能                 | 详细说明                                                     |
| :------------------- | :----------------------------------------------------------- |
| **订单列表（后台）** | 展示全部订单，支持按订单号/手机号/航线/日期/状态筛选；状态标签页：全部、待付款、已付款、已确认、已出行、已取消、退款中、已退款；支持导出 Excel。 |
| **订单状态流转**     | 完整生命周期：已创建 → 待付款 → 已付款 → 已确认（出票） → 待出行 → 已出行 → 已完成；异常状态：已取消、退款申请中、退款处理中、已退款。每次状态变更记录操作人、操作时间、备注。 |
| **在线支付**         | 根据平台不同，支持微信支付、支付宝支付、银联支付等（小程序 JSAPI 支付 + H5/网页 Native 支付）；支付回调处理：验签、更新订单状态、释放/确认库存锁定；支付超时自动关闭订单并释放舱位；支付金额需与订单金额严格校验防止篡改。 |
| **退改处理**         | 用户可在"我的订单"中发起退改申请；退改规则按距出发日天数阶梯设置（如 >30天全退、15-30天退80%、7-15天退50%、<7天不可退等，比例需可手动编辑）；后台审核退改申请，审核通过后自动发起退款并释放库存。 |
| **财务对账**         | 每日自动生成对账报表：订单金额汇总、实收金额、退款金额、手续费；支持按日/周/月查看；支持与微信支付账单自动核对差异。 |

### E. 用户系统（后台 + 前台）

| 功能                      | 详细说明                                                     |
| :------------------------ | :----------------------------------------------------------- |
| **用户注册/登录（前台）** | 小程序：微信一键授权登录（获取手机号）；网页：手机号+验证码登录，微信扫码登录，支付宝扫码登录；登录后自动创建用户档案，使用其中一种方式登录的，可由客户自行绑定另外两种登录方式。 |
| **我的订单（前台）**      | 用户查看自己的全部订单，按状态 Tab 筛选；每个订单卡片展示：航线信息、舱位信息、金额、状态、操作按钮（去支付/查看详情/申请退改/申请电子发票/查看房号/查收出团通知书等）。 |
| **员工账号管理（后台）**  | 管理后台操作人员账号：账号CRUD、角色分配；角色管理：自定义角色及其权限（基于 Casbin RBAC）；预设角色：超级管理员、运营人员、财务人员、客服人员；操作日志：记录所有后台操作行为。 |
| **店铺/品牌信息（后台）** | 配置店铺名称、Logo、联系方式、公司介绍（富文本）、客服信息、备案信息等；这些信息展示在前台页面底部和"关于我们"页面。 |

### F. 消息通知

| 功能                     | 详细说明                                                     |
| :----------------------- | :----------------------------------------------------------- |
| **订单通知**             | 下单成功、支付成功、订单确认（出票）、退改审核结果通知；渠道：微信小程序订阅消息、微信服务号模板消息、站内消息、短信（可配置）；后台可配置每种通知类型的开关及通知模板内容。 |
| **库存预警通知（后台）** | 当某航次某舱型可用库存低于预警阈值时，自动通知运营人员；通知渠道：后台消息中心、邮件、企业微信。 |

### G. 基础数据统计（后台）

| 功能         | 详细说明                                                     |
| :----------- | :----------------------------------------------------------- |
| **数据看板** | 今日概览：今日订单数、今日营收、今日新用户、今日页面访问量；趋势图：近 7/30 天订单量趋势、营收趋势；舱位热度排行：最受欢迎的航线、舱型；库存概览：各航次各舱型库存饼图。 |

------

## 第三类：一站式订位体验完整功能

> 在 MVP 基础上，超越基础预订，打造"想去邮轮旅行→完成旅程"的全流程无缝体验。

### H. 智能发现与决策支持（前台）

| 功能             | 详细说明                                                     |
| :--------------- | :----------------------------------------------------------- |
| **智能舱位推荐** | 基于用户偏好（历史浏览、收藏、预算范围、出行人数、旅行风格标签）AI 智能推荐最匹配的舱位；首页个性化推荐卡片流；推荐算法可在后台配置权重参数。 |
| **航线日历视图** | 以日历形式展示各航线的出发日期；每个日期格子显示最低价格；颜色编码标识价格区间（绿=低价、黄=常规、红=高价）；点击日期直接进入该航次舱位选择。 |
| **价格趋势分析** | 展示某航线/舱型的历史价格走势折线图；标注最低价出现时间段；预测最佳预订时机提示（如"建议提前 45 天预订"）。 |
| **舱位对比工具** | 最多支持 3 个舱位并排对比：对比维度包括价格、面积、位置、设施、用户评分、甲板层数、舱型等级。 |
|                  |                                                              |
|                  |                                                              |

### I. 便捷预订流程增强（前台）

| 功能              | 详细说明                                                     |
| :---------------- | :----------------------------------------------------------- |
|                   |                                                              |
| **一键锁定舱位**  | 支付前临时锁定舱位（15分钟倒计时），避免抢位失败；锁定期间该舱位对其他用户显示为"锁定中"；超时自动释放并通知用户。 |
| **分期付款**      | 支持定金+尾款分期模式：下单时支付定金（如总价30%），出发前 N 天支付尾款；定金比例、尾款截止日可在后台按航线配置。 |
| **多币种支付**    | 支持人民币（CNY）、美元（USD）、港币（HKD）、日元（JPY）结算；汇率自动从外部 API 获取并缓存；用户选择币种后全站价格同步切换显示。人民币为默认币种。 |
| **历史乘客快填**  | 自动从用户历史订单中提取乘客信息列表；下单时可一键选择已有乘客，无需重复输入。 |
| **证件 OCR 识别** | 拍照/上传护照/身份证图片 → 自动识别证件信息（姓名、证件号、有效期等） → 自动填入乘客信息表单。 |
| **团队批量预订**  | 旅行社/企业团体批量下单入口（后台+前台均可操作）；上传乘客名单 Excel 文件批量录入；团队专属价格（后台配置团队折扣规则）；团队订单独立管理页面。 |

### J. 岸上游与增值服务（前台 + 后台）

| 功能           | 详细说明                                                     |
| :------------- | :----------------------------------------------------------- |
|                |                                                              |
|                |                                                              |
| **出团通知书** | 出行前由具备权限的人员上传PDF格式的文件，客户可在前台查看；支持保存至手机，并需在设备上弹出消息通知客人查收。 |
| **出行倒计时** | 用户支付后在"我的订单"及首页显示出行倒计时；出发前自动推送行前准备清单（可在后台配置模板：证件检查、天气提醒、行李清单等）。 |

### K. 实时信息与互动（前台）

| 功能               | 详细说明                                                     |
| :----------------- | :----------------------------------------------------------- |
| **实时舱位状态**   | 通过 WebSocket 推送舱位库存变化；用户浏览舱位时实时显示"刚刚有 N 人正在查看"、"已售出 X 间"等紧迫感信息。 |
| **价格变动提醒**   | 用户可"关注"某航线/舱型；当价格下降/上涨超过阈值时推送通知。 |
| **预订进度追踪**   | 订单状态全流程可视化时间轴追踪；每个节点实时推送变更通知。   |
| **在线客服**       | 集成 AI 智能客服（FAQ 自动回复） + 人工客服转接；支持文字、图片发送；客服工作台在管理后台中。 |
| **天气与港口信息** | 展示航线沿途天气预报（调用第三方天气 API）；港口停靠信息：停靠时间、港口介绍、附近景点/交通信息。 |

### L. 社交与分享（前台）

| 功能             | 详细说明                                                     |
| :--------------- | :----------------------------------------------------------- |
| **行程分享海报** | 基于订单信息自动生成精美海报图片（航线地图+邮轮图+出发日期+舱位信息）；一键保存/分享到微信朋友圈；海报模板可在后台配置和更换。 |
| **邀请同行优惠** | 分享专属链接/二维码邀请好友同航次预订；好友下单成功后双方各获得优惠券/折扣；后台可配置邀请奖励规则。 |
| **用户真实评价** | 出行完成后邀请用户评价：航线评分（5星制）、舱位评分、服务评分；支持图片+视频评价；评价需后台审核后展示；评价数据自动关联到航线/舱位详情页。 |
| **旅行游记社区** | UGC 游记分享社区：用户发布图文游记；支持点赞、收藏、评论；后台审核管理；优质游记可推荐至首页种草位。 |
| **拼团出行**     | 陌生人拼团/拼舱功能：降低单人出行成本；后台设置拼团规则（最低成团人数、拼团价格、拼团有效期）；前台展示正在拼团的航次列表。 |

|      |      |
| :--- | :--- |
|      |      |
|      |      |
|      |      |

### M. 智能运营后台（后台）

| 功能                 | 详细说明                                                     |
| :------------------- | :----------------------------------------------------------- |
| **动态定价引擎**     | 根据库存水位、距离出发日天数、历史需求数据、竞品价格自动调价；后台配置定价规则（如库存<20%时自动涨价10%）；支持手动覆盖。 |
| **渠道库存分配**     | 多渠道独立库存池管理：直销、OTA、旅行社、分销各分配独立库存；渠道间库存可互相调拨；超卖保护机制。 |
| **智能预警系统**     | 多维预警：库存低水位预警、价格异常波动预警、超卖风险预警、支付异常预警；预警规则可自定义，通知方式可配置。 |
| **收益管理看板**     | 核心指标看板：RevPAR（每可用舱位收益）、上座率、渠道贡献比、客单价、转化率；支持按航线、时间段钻取。 |
| **客户生命周期管理** | CRM：从潜在客户→首航→复购的全生命周期管理；客户标签体系；客户画像（消费偏好、出行频次、消费能力分层）。 |
| **自动化营销引擎**   | 基于用户行为触发自动营销：浏览未购买→推送价格或时间；加购未支付→提醒通知；出行完成→邀请评价+推荐下次航程；后台配置触发条件和营销动作。 |
| **价格对比**         | 客户可手动选择若干航次及舱位，以并列的方式进行价格对比。     |
| **多语言支持**       | 后台及前台支持中文简体/繁体、英文、日文、韩文等多语言界面；内容翻译管理功能（后台编辑各语言版本的邮轮介绍、舱房介绍、设施介绍等）。 |

------

# 三、Plan（实施计划）

------

## 阶段一：MVP（第1-2个月）

### Sprint 1（第1-2周）：项目基建 + 邮轮介绍

**后端任务：**

1. 初始化 Go 1.26 项目，配置 Gin v1.11.0 + GORM + PostgreSQL 17 + Redis 7.4
2. 实现统一响应结构、全局错误处理、请求日志中间件、CORS 中间件
3. 实现 JWT 认证 + Casbin RBAC 权限中间件
4. 设计并创建数据库表：邮轮表(cruises)、邮轮公司表(cruise_companies)、舱房类型表(cabin_types)、设施分类表(facility_categories)、设施表(facilities)
5. 实现邮轮 CRUD API（含图片上传至 MinIO）
6. 实现舱房类型 CRUD API（含富文本内容存储）
7. 实现设施分类 + 设施 CRUD API
8. 编写全部上述 API 的单元测试 + 集成测试，覆盖率 100%
9. 自动生成 Swagger 文档

**管理后台（Nuxt 4）任务：**

1. 初始化 Nuxt 4.3.0 项目，配置 TypeScript 5.9、Tailwind CSS v4、Nuxt UI v3、Pinia v3
2. 实现登录页面、Layout 布局（侧边栏+顶部导航+内容区）
3. 实现邮轮管理页面（列表+新建/编辑表单+删除确认）
4. 集成 TipTap 富文本编辑器用于邮轮介绍、舱房介绍、设施介绍的内容编辑
5. 实现舱房类型管理页面
6. 实现设施分类 + 设施管理页面
7. 编写全部组件的 Vitest 单元测试 + Playwright E2E 测试，覆盖率 100%

**网页前台（Nuxt 4）任务：**

1. 初始化 Nuxt 4.3.0 项目（与后台独立），配置 SSR 模式
2. 实现首页 Layout、邮轮列表页、邮轮详情页（含舱房展示、设施导览）
3. 编写测试，覆盖率 100%

**小程序前台（uni-app）任务：**

1. 初始化 uni-app Vue 3 项目，配置 TypeScript、Pinia
2. 实现微信登录授权流程
3. 实现首页、邮轮列表页、邮轮详情页
4. 编写测试，覆盖率 100%

### Sprint 2（第3-4周）：舱位管理 + 浏览

**后端任务：**

1. 设计并创建表：航线表(routes)、航次表(voyages)、舱位表(cabins)、舱位库存表(cabin_inventory)、舱位价格表(cabin_prices)
2. 实现舱位 CRUD + 分类 + 属性 + 库存 + 定价全套 API
3. 实现舱位列表查询（支持多条件筛选、分页、排序）
4. 实现价格日历查询 API
5. 全部测试 100% 覆盖

**管理后台任务：**

1. 航线管理页面、航次管理页面
2. 舱位管理：列表（含筛选排序）、CRUD 表单、库存管理、价格矩阵编辑器（日历式价格设置）
3. 库存预警阈值设置
4. 全部测试 100% 覆盖

**前台（Web + 小程序）任务：**

1. 舱位列表页（带筛选条件、排序）
2. 舱位详情页（图片轮播、参数展示、价格日历、甲板位置图）
3. 全部测试 100% 覆盖

### Sprint 3（第5-6周）：下单 + 支付 + 订单管理

**后端任务：**

1. 设计并创建表：订单表(orders)、订单项表(order_items)、乘客信息表(passengers)、支付记录表(payments)
2. 实现下单 API：参数校验 → 库存锁定（Redis 分布式锁） → 生成订单 → 返回预付款信息
3. 实现微信支付集成：统一下单、支付回调、退款
4. 实现订单状态流转引擎（状态机模式）
5. 实现订单列表 + 详情 + 搜索 API
6. 实现超时未支付自动取消（NATS 延迟消息或 Redis 过期键监听）
7. 全部测试 100% 覆盖

**管理后台任务：**

1. 订单列表页（含状态 Tab、多条件搜索、导出 Excel）
2. 订单详情页（订单信息+乘客信息+支付记录+操作日志时间轴）
3. 订单操作：确认、取消、备注
4. 全部测试 100% 覆盖

**前台任务：**

1. 下单流程页面（选舱 → 填写乘客信息 → 确认订单 → 支付）
2. 支付结果页
3. 「我的订单」列表 + 详情页
4. 全部测试 100% 覆盖

### Sprint 4（第7-8周）：用户系统 + 退改 + 通知 + 对账 + 数据统计

**后端任务：**

1. 设计并创建表：用户表(users)、员工表(staffs)、角色表(roles)、消息通知表(notifications)、退改申请表(refund_requests)
2. 实现用户注册/登录（微信登录、手机号+验证码）
3. 实现员工账号 CRUD + 角色权限管理
4. 实现退改申请 + 审核 + 自动退款 API
5. 实现消息通知发送（微信订阅消息、站内消息、短信通道对接）
6. 实现财务对账报表 API
7. 实现数据统计看板 API
8. 全部测试 100% 覆盖

**管理后台任务：**

1. 员工管理 + 角色权限管理页面
2. 退改申请列表 + 审核页面
3. 消息通知配置页面（通知模板、开关）
4. 财务对账页面（报表、对账明细）
5. 数据看板首页（ECharts 图表）
6. 店铺/品牌信息配置页面
7. 全部测试 100% 覆盖

**前台任务：**

1. 用户个人中心（基本信息、常用乘客管理）
2. 退改申请提交页面
3. 站内消息列表
4. 全部测试 100% 覆盖

**MVP 交付物**：可用的舱位预订系统，用户可浏览邮轮和舱位、在线下单支付、管理订单。

------

## 阶段二：V1.0 完善（第3-4个月）

### Sprint 5-6：岸上游 + 电子船票 + 出行倒计时 + 在线客服

1. 岸上游产品后台管理 + 前台预订流程
2. 电子船票生成（PDF + QR 码）+ 微信卡包集成
3. 出行倒计时组件 + 行前准备清单推送
4. 在线客服集成（AI FAQ + 人工转接）
5. 常用乘客快填功能
6. 全部测试 100% 覆盖

### Sprint 7-8：评价系统 + 分享海报 + 会员基础

1. 用户评价体系（评分+图文评价+后台审核）
2. 行程分享海报生成（Canvas/服务端生成）
3. 会员等级体系 + 积分系统基础
4. 邀请同行优惠功能
5. 全部测试 100% 覆盖

------

## 阶段三：V1.5 智能化（第5-6个月）

### Sprint 9-10：智能推荐 + VR 预览 + 交互甲板图

1. 智能舱位推荐算法（协同过滤/规则引擎）+ 后台配置
2. 航线日历视图 + 价格趋势分析图表
3. 舱位对比工具
4. 360° 全景 VR 舱位预览集成
5. 交互式甲板图开发（SVG/Canvas 可点击甲板）
6. 全部测试 100% 覆盖

### Sprint 11-12：动态定价 + 多币种 + OCR + 分期付款

1. 动态定价引擎（规则配置+自动调价+手动覆盖）
2. 多币种支付（汇率 API + 币种切换 + 结算）
3. 证件 OCR 识别集成（第三方 API 对接）
4. 分期付款（定金+尾款模式）
5. 全部测试 100% 覆盖

------

## 阶段四：V2.0 生态化（第7-9个月）

### Sprint 13-14：社区 UGC + 拼团 + 积分商城

1. 旅行游记社区（发布+审核+首页推荐）
2. 拼团出行功能（拼团规则+前台拼团页+自动成团/退款）
3. 积分商城（商品管理+兑换流程+库存管理）
4. 全部测试 100% 覆盖

### Sprint 15-16：多渠道分销 + 智能运营 + 多语言

1. 渠道库存分配 + 分销管理
2. 智能预警系统 + 收益管理看板
3. 客户生命周期 CRM + 自动化营销引擎
4. 竞品监控看板
5. 团队批量预订功能
6. 多语言支持（i18n 框架 + 内容翻译管理后台）
7. WebSocket 实时舱位状态 + 价格变动提醒 + 天气港口信息
8. 全部测试 100% 覆盖

------

## 质量保障总则（贯穿全阶段）

1. **每个 Sprint 结束时**，所有后端代码（Go）测试覆盖率必须 = 100%，使用 `go test -coverprofile` 检查
2. **每个 Sprint 结束时**，所有前端代码（Nuxt 4 后台、Nuxt 4 前台、uni-app 小程序）测试覆盖率必须 = 100%，使用 Vitest coverage / jest coverage 检查
3. **CI/CD Pipeline** 中必须包含：lint 检查 → 单元测试 → 集成测试 → E2E 测试 → 覆盖率阈值卡控（100%）→ 构建 → 部署
4. **每个 API** 必须有对应的 Swagger 文档，CI 中自动校验文档与代码一致性
5. **数据库变更**使用迁移文件管理，禁止手动修改数据库结构
6. **代码审查**：所有代码必须经过 PR 审查后才能合并至主分支